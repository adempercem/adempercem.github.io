<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Devim Render Arşivi</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0f0f0f; color: #eee; margin: 0; text-align: center; }
        header { background: #1a1a1a; padding: 1.5rem; border-bottom: 2px solid #333; }
        h1 { color: #00a8ff; margin: 0; }
        .gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 25px; padding: 20px; max-width: 1400px; margin: 0 auto; }
        .card { background: #1e1e1e; border-radius: 12px; border: 1px solid #333; padding: 15px; text-align: left; display: flex; flex-direction: column; }
        .card:hover { border-color: #00a8ff; }
        .card img { width: 100%; aspect-ratio: 1/1; object-fit: cover; border-radius: 8px; margin-bottom: 12px; }
        .title { font-size: 1.1rem; color: #fff; font-weight: bold; margin-bottom: 8px; }
        .description { font-size: 0.85rem; color: #ccc; line-height: 1.4; margin-bottom: 10px; flex-grow: 1; }
        .tags { font-size: 0.75rem; color: #00a8ff; margin-bottom: 15px; }
        .download-btn { display: block; background: #444; color: white; text-decoration: none; padding: 10px; border-radius: 6px; text-align: center; font-weight: bold; pointer-events: none; opacity: 0.6; transition: 0.3s; }
        .ads { background: #1a1a1a; border: 1px dashed #444; margin: 20px auto; padding: 20px; max-width: 800px; color: #666; }
    </style>
</head>
<body>

<header><h1>Devim Render Portfolyo</h1></header>
<div class="ads">REKLAM ALANI (ÜST)</div>
<div class="gallery" id="main-gallery"></div>
<div class="ads:">REKLAM ALANI (ALT)</div>

<script>
    const baseUrl = "https://pub-40fcbb1ac04f4b2eae4ccd3c94e7a970.r2.dev/render/";

    fetch('metadata.csv')
        .then(res => res.text())
        .then(data => {
            // Satırları ayır ve boş satırları temizle
            const rows = data.split('\n').filter(row => row.trim() !== "");
            const gallery = document.getElementById('main-gallery');
            
            // İlk satır başlık olduğu için 1. indexten başlıyoruz
            for (let i = 1; i < rows.length; i++) {
                // CSV'deki tırnak içindeki virgülleri korumak için regex kullanıyoruz
                const cols = rows[i].match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
                if (!cols) continue;

                const file = cols[0].replace(/"/g, "");
                const title = cols[1].replace(/"/g, "");
                const subjects = cols[2].replace(/"/g, "").split(',').map(s => "#" + s.trim()).join(' ');
                const desc = cols[3].replace(/"/g, "");
                
                const btnId = `btn-${i}`;
                
                gallery.innerHTML += `
                    <div class="card">
                        <img src="${baseUrl}thumbnails/${file}" alt="${title}">
                        <div class="title">${title}</div>
                        <div class="description">${desc}</div>
                        <div class="tags">${subjects}</div>
                        <a href="${baseUrl}${file}" target="_blank" id="${btnId}" class="download-btn">Bekleyin (5s)</a>
                    </div>
                `;
                startTimer(5, btnId);
            }
        });

    function startTimer(duration, elementId) {
        let timer = duration;
        const display = document.getElementById(elementId);
        const countdown = setInterval(() => {
            timer--;
            display.innerText = `Bekleyin (${timer}s)`;
            if (timer <= 0) {
                clearInterval(countdown);
                display.innerText = "RESMİ AÇ";
                display.style.background = "#00a8ff";
                display.style.pointerEvents = "auto";
                display.style.opacity = "1";
            }
        }, 1000);
    }
</script>
</body>
</html>
